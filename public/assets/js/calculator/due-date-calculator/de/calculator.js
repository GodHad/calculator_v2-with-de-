function calculate(){const basedOn=input.get('based_on').index().val();const firstDay=input.get('first_day').date().raw();let avgCyclesLength=input.get('avg_cycles_length').index().val();const ultrasoundDate=input.get('ultrasound_date').date().raw();const pregnancyWeeks=input.get('pregnancy_weeks').val();const pregnancyDays=input.get('pregnancy_days').val();const conceptionDate=input.get('conception_date').date().raw();const transferDate=input.get('transfer_date').date().raw();let embryoAge=input.get('embryo_age').index().val();avgCyclesLength=avgCyclesLength+22;embryoAge=embryoAge+3;if(!input.valid())return;else if(basedOn===0){if(!firstDay){return input.error('first_day','Geben Sie den ersten Tag ein',true);}
else{const date=new Date(firstDay);const startDate=new Date(firstDay);const cycleDays=Number(avgCyclesLength-28);startDate.setDate(date.getDate()+cycleDays);showResult(startDate);}}
else if(basedOn===1){if(!ultrasoundDate){input.error('ultrasound_date','Geben Sie das Datum des Ultraschalls ein');}
if(!pregnancyWeeks){input.error('pregnancy_weeks','Geben Sie die Schwangerschaftsdauer zu diesem Zeitpunkt ein');}
if(!input.valid())return;const date=ultrasoundDate;const days=Number(pregnancyWeeks*7)+Number(pregnancyDays);const startDate=ultrasoundDate;startDate.setDate(date.getDate()-days);showResult(startDate);}
else if(basedOn===2){const date=conceptionDate;const startDate=conceptionDate;startDate.setDate(date.getDate()-14);showResult(startDate);}
else if(basedOn===3){const date=new Date(transferDate);const startDate=new Date(transferDate);startDate.setDate(date.getDate()-Number(embryoAge)-14);showResult(startDate);}}
function dateDiff(startingDate,endDate){if(!startingDate||!endDate){return false;}
return Math.floor((endDate.getTime()-startingDate.getTime())/(1000*3600*24));}
function showResult(date){const days=dateDiff(date,new Date());if(days<0||days>294){_('not-pregnant').style='display: block';_('result').style='display: none';_('milestones').style='display: none';output.val(`Es ist wahrscheinlich, dass Sie noch nicht schwanger sind.`).set('not-pregnant-result');}
else{_('not-pregnant').style='display: none';_('result').style='display: block';_('milestones').style='display: block';let trimester=Math.floor(days/90)+1;switch(trimester){case 1:trimester='Erster';break;case 2:trimester='Zweiter';break;case 3:trimester='Dritter';}
const currentWeek=(Math.floor(days/7)+1);let size='Im Durchschnitt wiegt Ihr Baby in diesem Stadium weniger als 1 Gramm.';let babySize=BABY_SIZE_CHART.find(item=>item.week===currentWeek-1);if(babySize){size=`${babySize.usLength} (${babySize.euLength}) and ${babySize.usWeight} (${babySize.euWeight})`;}
const estimatedDueDate=new Date();estimatedDueDate.setDate(estimatedDueDate.getDate()+(280-days));const conceiveDate=new Date(date);conceiveDate.setDate(conceiveDate.getDate()+14);output.val(trimester).set('trimester');output.val(convertDateToDMY(conceiveDate)).set('conceive-date');output.val(weekDate(date,1,1)).set('week-1-date');output.val(weekDate(date,3,1)).set('week-3-date');output.val(weekDate(date,4,1)).set('week-4-date');output.val(weekDate(date,6,2)).set('week-6-date');output.val(weekDate(date,13,1)).set('week-13-date');output.val(weekDate(date,18,4)).set('week-18-date');output.val(weekDate(date,23,1)).set('week-23-date');output.val(weekDate(date,28,1)).set('week-28-date');output.val(convertDateToDMY(estimatedDueDate)).set('estimate-due-date');output.val(size).set('baby-size');output.val('Woche {#23}').replace('{#23}',`#${currentWeek}`).set('current-date')}}
function convertDateToDMY(date){const months=['Jan','Feb','MÃ¤r','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'];const day=date.getDate();const monthIndex=date.getMonth();const year=date.getFullYear();return `${months[monthIndex]} ${day}, ${year}`;}
const BABY_SIZE_CHART=[{week:8,usLength:'0.62 Zoll',usWeight:'0.71 Unzen',euLength:'1.57 cm',euWeight:'20 Gramm',},{week:9,usLength:'0.91 Zoll',usWeight:'0.95 Unzen',euLength:'2.3 cm',euWeight:'27 Gramm',},{week:10,usLength:'1.22 Zoll',usWeight:'1.23 Unzen',euLength:'3.1 cm',euWeight:'35 Gramm',},{week:11,usLength:'1.61 Zoll',usWeight:'1.59 Unzen',euLength:'4.1 cm',euWeight:'45 Gramm',},{week:12,usLength:'2.13 Zoll',usWeight:'2.05 Unzen',euLength:'5.4 cm',euWeight:'58 Gramm',},{week:13,usLength:'2.64 Zoll',usWeight:'2.58 Unzen',euLength:'6.7 cm',euWeight:'73 Gramm',},{week:14,usLength:'5.79 Zoll',usWeight:'3.28 Unzen',euLength:'14.7 cm',euWeight:'93 Gramm',},{week:15,usLength:'6.57 Zoll',usWeight:'4.13 Unzen',euLength:'16.7 cm',euWeight:'117 Gramm',},{week:16,usLength:'7.32 Zoll',usWeight:'5.15 Unzen',euLength:'18.6 cm',euWeight:'146 Gramm',},{week:17,usLength:'8.03 Zoll',usWeight:'6.38 Unzen',euLength:'20.4 cm',euWeight:'181 Gramm',},{week:18,usLength:'8.74 Zoll',usWeight:'7.87 Unzen',euLength:'22.2 cm',euWeight:'223 Gramm',},{week:19,usLength:'9.45 Zoll',usWeight:'9.63 Unzen',euLength:'24 cm',euWeight:'273 Gramm',},{week:20,usLength:'10.12 Zoll',usWeight:'11.68 Unzen',euLength:'25.7 cm',euWeight:'331 Gramm',},{week:21,usLength:'10.79 Zoll',usWeight:'14.07 Unzen',euLength:'27.4 cm',euWeight:'399 Gramm',},{week:22,usLength:'11.42 Zoll',usWeight:'1.05 Pfund',euLength:'29 cm',euWeight:'478 Gramm',},{week:23,usLength:'12.05 Zoll',usWeight:'1.25 Pfund',euLength:'30.6 cm',euWeight:'568 Gramm',},{week:24,usLength:'12.68 Zoll',usWeight:'1.48 Pfund',euLength:'32.2 cm',euWeight:'670 Gramm',},{week:25,usLength:'13.27 Zoll',usWeight:'1.73 Pfund',euLength:'33.7 cm',euWeight:'785 Gramm',},{week:26,usLength:'13.82 Zoll',usWeight:'2.01 Pfund',euLength:'35.1 cm',euWeight:'913 Gramm',},{week:27,usLength:'14.41 Zoll',usWeight:'2.33 Pfund',euLength:'36.6 cm',euWeight:'1055 Gramm',},{week:28,usLength:'14.8 Zoll',usWeight:'2.67 Pfund',euLength:'37.6 cm',euWeight:'1210 Gramm',},{week:29,usLength:'15.47 Zoll',usWeight:'3.04 Pfund',euLength:'39.3 cm',euWeight:'1379 Gramm',},{week:30,usLength:'15.95 Zoll',usWeight:'3.44 Pfund',euLength:'40.5 cm',euWeight:'1559 Gramm',},{week:31,usLength:'16.46 Zoll',usWeight:'3.86 Pfund',euLength:'41.8 cm',euWeight:'1751 Gramm',},{week:32,usLength:'16.93 Zoll',usWeight:'4.3 Pfund',euLength:'43 cm',euWeight:'1953 Gramm',},{week:33,usLength:'17.36 Zoll',usWeight:'4.77 Pfund',euLength:'44.1 cm',euWeight:'2162 Gramm',},{week:34,usLength:'17.84 Zoll',usWeight:'5.24 Pfund',euLength:'45.3 cm',euWeight:'2377 Gramm',},{week:35,usLength:'18.23 Zoll',usWeight:'5.72 Pfund',euLength:'46.3 cm',euWeight:'2595 Gramm',},{week:36,usLength:'18.62 Zoll',usWeight:'6.20 Pfund',euLength:'47.3 cm',euWeight:'2813 Gramm',},{week:37,usLength:'19.02 Zoll',usWeight:'6.68 Pfund',euLength:'48.3 cm',euWeight:'3028 Gramm',},{week:38,usLength:'19.41 Zoll',usWeight:'7.13 Pfund',euLength:'49.3 cm',euWeight:'3236 Gramm',},{week:39,usLength:'19.72 Zoll',usWeight:'7.57 Pfund',euLength:'50.1 cm',euWeight:'3435 Gramm',},{week:40,usLength:'20.08 Zoll',usWeight:'7.98 Pfund',euLength:'51 cm',euWeight:'3619 Gramm',},{week:41,usLength:'20.39 Zoll',usWeight:'8.35 Pfund',euLength:'51.8 cm',euWeight:'3787 Gramm',},]
function weekDate(start,week,weeks=1){const startDate=new Date(start);startDate.setDate(startDate.getDate()+((week-1)*7)+1);const endDate=new Date(startDate);endDate.setDate(endDate.getDate()+(weeks*7)-1);return convertDateToDMY(startDate)+' - '+convertDateToDMY(endDate);}